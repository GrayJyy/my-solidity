恒定总和自动做市商（CSAMM）和恒定乘积自动做市商（CPAMM）是加密货币领域中两种不同的自动做市（AMM）机制。它们各有特点和适用场景。

恒定总和自动做市商（CSAMM）
机制：在CSAMM中，两种资产的总和保持恒定。例如，如果池子中有100个A币和100个B币，则无论交易如何进行，A币和B币的总和始终保持200。

价格波动：这种机制在价格波动较小的稳定币或者价值相近的资产间交易中效果较好。因为大幅的价格波动会使其中一种资产被迅速耗尽。

应用场景：CSAMM适用于那些价格相对稳定或者挂钩的资产，例如不同平台之间的稳定币对。

恒定乘积自动做市商（CPAMM）
机制：在CPAMM中，两种资产的乘积保持恒定。例如，如果池子中有100个A币和100个B币，那么A币和B币的乘积始终是10000（100 x 100），无论交易如何进行。

价格适应性：这种机制更适合应对价格波动较大的资产。当一种资产的价格上升时，该机制会增加购买这种资产的成本，从而抑制需求并帮助平衡价格。

应用场景：CPAMM非常适合于那些价格波动较大的普通加密货币交易对，如ETH/BTC等。这种机制是目前最流行的AMM模型，被广泛应用于Uniswap等去中心化交易所（DEX）。

总结
恒定总和（CSAMM）：更适合稳定或价值相近的资产，因为它不适合处理大幅价格波动。
恒定乘积（CPAMM）：适用于常见的加密货币对，能更好地处理价格波动。

去中心化交易所 
交易所主要有两类参与者：流动性提供者（Liquidity Provider，LP）和交易者（Trader）。
流动性提供(LP)
流动性提供者给市场提供流动性，让交易者获得更好的报价和流动性，并收取一定费用。

首先，我们需要实现添加流动性的功能。当用户向代币池添加流动性时，合约要记录添加的LP份额。根据 Uniswap V2，LP份额如下计算：
代币池被首次添加流动性时，LP份额 
 由添加代币数量乘积的平方根决定:
`\Delta{L}=\sqrt{\Delta{x} *\Delta{y}}`



非首次添加流动性时，LP份额由添加代币数量占池子代币储备量的比例决定（两个代币的比例取更小的那个）:
`\Delta{L}=L*\min{(\frac{\Delta{x}}{x}, \frac{\Delta{y}}{y})}`

 
 
